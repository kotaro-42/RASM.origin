<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <meta name="rnbo-version" content="1.0.0-alpha.5">
    <link rel="stylesheet" href="style/style.css">
    <title>RASM origin</title>
</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <svg id="background" width="100%" height="100%"></svg>
    <div id="rnbo-root">
		<div>
			<h1 id="patcher-title">Unnamed patcher</h1>
		</div>
        <div id="rnbo-clickable-keyboard">
        </div>
        <div id="rnbo-inports">
            <form id="inport-form" className="inport">
                <div className="inport-input">
                    <select id="inport-select"></select>
                    <input id="inport-text" type="text"></input>
                    <input id="inport-submit" className="smallButton" type="submit" value="Send"/>
                </div>
            </form>
        </div>
		<div id="rnbo-console">
			<div id="rnbo-console-div">
			</div>
		</div>
		<div id="rnbo-presets">
			<select id="preset-select"></select>
		</div>
        <div id="rnbo-parameter-sliders">
            <h2>Parameters</h2>
        </div>
    </div>

    <!-- Load the script that creates the RNBO device  -->
    <!-- Uncomment if you know the version of your exported RNBO patch to avoid dynamic loading -->
    <!-- <script type="text/javascript" src="https://cdn.cycling74.com/rnbo/latest/rnbo.min.js"></script> -->

    <!-- (Optional) The guardrails.js script isn't required for RNBO to work, and you can skip including it -->
    <!-- It simply offers some helpful error messages for common problems -->
    <script type="text/javascript" src="js/guardrails.js"></script>

    <!-- Import RNBO Engine Wrapper -->
    <!-- Make sure to include the RNBO engine version to the version of your exported code, found in rnbopackage.json -->
    <script type="text/javascript" src="js/app.js"></script>


    <!-- ▼▼▼▼▼ ここから Web Audio API マイク入力追加コード ▼▼▼▼▼ -->
    <script>
    (async () => {
        // app.js の RNBO デバイス準備が完了するまで待つ
        // app.js 内で window.rnboDevice と window.rnboContext を設定しておく必要があります

        // RNBO デバイスが読み込み完了するまで待つ
        while (!window.rnboDevice || !window.rnboContext) {
            await new Promise(resolve => setTimeout(resolve, 50));
        }

        const context = window.rnboContext;
        const device = window.rnboDevice;

        try {
            // マイク取得
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const micSource = context.createMediaStreamSource(stream);

            // RNBO AudioWorkletNode の input に接続
            micSource.connect(device.node);

            console.log("Microphone successfully connected to RNBO input.");
        } catch (e) {
            console.error("Microphone access error:", e);
        }
    })();
    </script>
    <!-- ▲▲▲▲▲ ここまで追加コード ▲▲▲▲▲ -->

</body>
</html>
